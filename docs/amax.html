<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Recommendations from Floodnet Project 1-6</title>
  <meta name="description" content="Test">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Recommendations from Floodnet Project 1-6" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Test" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Recommendations from Floodnet Project 1-6" />
  
  <meta name="twitter:description" content="Test" />
  

<meta name="author" content="Martin Durocher">


<meta name="date" content="2019-01-28">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="references.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Floodnet Project 1-6</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome</a></li>
<li class="chapter" data-level="2" data-path="amax.html"><a href="amax.html"><i class="fa fa-check"></i><b>2</b> Annual maximums</a><ul>
<li class="chapter" data-level="2.1" data-path="amax.html"><a href="amax.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="amax.html"><a href="amax.html#estimation-of-the-flood-quantiles"><i class="fa fa-check"></i><b>2.2</b> Estimation of the flood quantiles</a></li>
<li class="chapter" data-level="2.3" data-path="amax.html"><a href="amax.html#verification-of-the-model"><i class="fa fa-check"></i><b>2.3</b> Verification of the model</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Recommendations from Floodnet Project 1-6</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="amax" class="section level1">
<h1><span class="header-section-number">Section 2</span> Annual maximums</h1>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">2.1</span> Introduction</h2>
<p>In this document I will show how to use <code>floodnetRfa</code> to perform at-site
frequency analysis using annual maximum discharge.
First we will extract the annual maximums from the
daily discharge data of the Saint-John River at Fort Kent (NB).
Note that incomplet year with missing observations will be removed.
In total 88 annual maximums are extracted and showed in a histogram.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(floodnetRfa)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">anData &lt;-<span class="st"> </span><span class="kw">ExtractAmax</span>(flow <span class="op">~</span><span class="st"> </span>date, flowStJohn, <span class="dt">tol =</span> <span class="dv">365</span>)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">npDens &lt;-<span class="st"> </span><span class="kw">density</span>(anData<span class="op">$</span>flow)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">hist</span>(anData<span class="op">$</span>flow, </a>
<a class="sourceLine" id="cb1-8" data-line-number="8">     <span class="dt">freq =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb1-9" data-line-number="9">     <span class="dt">main =</span> <span class="st">&#39;&#39;</span>, </a>
<a class="sourceLine" id="cb1-10" data-line-number="10">     <span class="dt">xlab =</span> <span class="st">&#39;Discharge&#39;</span>,</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">max</span>(npDens<span class="op">$</span>y)))</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="kw">lines</span>(npDens, <span class="dt">col =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="FloodnetProject16_files/figure-html/unnamed-chunk-1-1.png" width="480" /></p>
<p>In stationary situation, the annual maximums are assumed to be independant and
identically distributed.
Risk is then measure in terms of return period that characterizes the
average time separating two events of the same magnitude.
In practice this is equivalent to calculate the probability <span class="math inline">\(p = 1-1/T\)</span> of a
fitted distribution.
The test of Mann-Kendall is frequently performed to verify if the data contains
a significant trend that would invalidate the assumption of stationarity.
The present data have a p-value of 0.21, which does not suggest the present of
a trend.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">plot</span>(flow<span class="op">~</span>date, anData)</a></code></pre></div>
<div class="figure"><span id="fig:amax-mkendall"></span>
<img src="FloodnetProject16_files/figure-html/amax-mkendall-1.png" alt="Trend in the annual maximums" width="672" />
<p class="caption">
Figure 2.1: Trend in the annual maximums
</p>
</div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">MKendall</span>(anData<span class="op">$</span>flow)</a></code></pre></div>
<pre><code>## 
## 
## Mann-Kendall Test for trend
## S:  346
## p-value:  0.2136</code></pre>
</div>
<div id="estimation-of-the-flood-quantiles" class="section level2">
<h2><span class="header-section-number">2.2</span> Estimation of the flood quantiles</h2>
<p>According to extreme value theory, as the number of annual maximums increase,
their distribution converge to Generalized Extreme Value (GEV) distribution</p>
<p><span class="math display" id="eq:amax-gevcdf">\[\begin{equation}
F(x) = \exp\left\{ - \left[ 1 - \kappa \left(\frac{x-\xi}{\alpha} \right) \right]^{1/\kappa} \right\}
\tag{2.1}
\end{equation}\]</span></p>
<p>The GEV distribution in Equation <a href="amax.html#eq:amax-gevcdf">(2.1)</a> can be fitted using the <code>FitAmax</code> function.
The example below shows how the parameter are estimated using the
maximum likelihood method.
See for instance <span class="citation">(Coles <a href="#ref-coles_introduction_2001">2001</a>)</span>.
A brief summary of the fitted model is reported, including the estimated parameter,
their standard deviation and the sample L-moments.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">fit &lt;-<span class="st"> </span><span class="kw">FitAmax</span>(anData<span class="op">$</span>flow, <span class="st">&#39;gev&#39;</span>, <span class="dt">method =</span> <span class="st">&#39;mle&#39;</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw">print</span>(fit)</a></code></pre></div>
<pre><code>## 
## At-site frequency analysis
## 
## Distribution: gev 
## AIC: 1411 
## Method: mle
## Estimate:
##        xi     alpha     kappa 
## 2101.3761  668.9518    0.1667 
## 
## Std.err:
##       xi    alpha    kappa 
## 78.39437 54.31311  0.06214 
## 
## Lmoments:
##     l1  lcv     lsk    lkt
## 1 2390 0.17 0.05924 0.1399</code></pre>
<p>The flood quantile of the GEV distribution can be obtained from the formula</p>
<p><span class="math display">\[
x_T = \mu + \frac{\alpha}{\xi}\left[ 1+\log(1/T)^\kappa \right] .
\]</span>
These predicted value are computed using the <code>predict</code> function.
In the example below show the flood quantile for return period 2, 5, 10, 20, 50
and 100.
The standard deviation of the flood quantiles is estimated using the Delta
method that assume that the estimated parameter follow a Normal distribution.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">yhat &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, <span class="dt">se =</span> <span class="ot">TRUE</span>, <span class="dt">ci =</span> <span class="st">&#39;delta&#39;</span>)</a></code></pre></div>
<table>
<caption><span id="tab:amax-yhat">Table 2.1: </span>Predicted return levels</caption>
<thead>
<tr class="header">
<th align="right">pred</th>
<th align="right">se</th>
<th align="right">lower</th>
<th align="right">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2339.216</td>
<td align="right">82.44124</td>
<td align="right">2177.634</td>
<td align="right">2500.798</td>
</tr>
<tr class="even">
<td align="right">2989.156</td>
<td align="right">99.81724</td>
<td align="right">2793.518</td>
<td align="right">3184.794</td>
</tr>
<tr class="odd">
<td align="right">3356.637</td>
<td align="right">117.79148</td>
<td align="right">3125.770</td>
<td align="right">3587.504</td>
</tr>
<tr class="even">
<td align="right">3668.464</td>
<td align="right">144.52611</td>
<td align="right">3385.198</td>
<td align="right">3951.730</td>
</tr>
<tr class="odd">
<td align="right">4020.327</td>
<td align="right">193.47341</td>
<td align="right">3641.126</td>
<td align="right">4399.528</td>
</tr>
<tr class="even">
<td align="right">4250.404</td>
<td align="right">238.46296</td>
<td align="right">3783.025</td>
<td align="right">4717.783</td>
</tr>
</tbody>
</table>
</div>
<div id="verification-of-the-model" class="section level2">
<h2><span class="header-section-number">2.3</span> Verification of the model</h2>
<p>The return level plot in <a href="amax.html#fig:amax-gevreturnlevel">2.2</a> provide a visual
assessment of the fitted distribution by comparing the sample and
the predicted flood quantiles.
The graphic below shows a good agreement between the two.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">plot</span>(fit, <span class="dt">ci =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure"><span id="fig:amax-gevreturnlevel"></span>
<img src="FloodnetProject16_files/figure-html/amax-gevreturnlevel-1.png" alt="Return level plot for Saint-John River at Fort Kent, NB." width="672" />
<p class="caption">
Figure 2.2: Return level plot for Saint-John River at Fort Kent, NB.
</p>
</div>
<p>Another diagnostic to ensure that the GEV distribution is appropriate is the
Anderson-Darling test. The p-value superior to 0.05 indicates that the
hypothesis of a GEV cannot be rejected.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">## Time consuming when estimated by &#39;mle&#39;</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw">GofTest</span>(fit, <span class="dt">nsim =</span> <span class="dv">500</span>)</a></code></pre></div>
<pre><code>## 
## Goodness-of-fit test for annual maxima
##  
## Test = Anderson-Darling 
## Distribution = gev
## statistic : 0.266 
## p-value : 0.534</code></pre>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-coles_introduction_2001">
<p>Coles, S. 2001. <em>An Introduction to Statistical Modeling of Extreme Values</em>. Springer Verlag.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
